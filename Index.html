<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congregation Care Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
        }

        h1 {
            color: #2d3748;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            background: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: none;
        }

        .content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
        }

        .care-list {
            margin-top: 30px;
        }

        .care-item {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .care-item:hover {
            background: #edf2f7;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .care-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .care-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #2d3748;
        }

        .care-date {
            color: #718096;
            font-size: 0.9em;
        }

        .care-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.85em;
            color: #718096;
            margin-bottom: 3px;
        }

        .detail-value {
            font-weight: 600;
            color: #2d3748;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-active { background: #c6f6d5; color: #22543d; }
        .badge-answered { background: #bee3f8; color: #2c5282; }
        .badge-ongoing { background: #feebc8; color: #7c2d12; }
        .badge-scheduled { background: #d6bcfa; color: #44337a; }
        .badge-completed { background: #c6f6d5; color: #22543d; }
        .badge-high { background: #fed7d7; color: #742a2a; }
        .badge-moderate { background: #feebc8; color: #7c2d12; }
        .badge-low { background: #c6f6d5; color: #22543d; }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üôè Congregation Care Tracker</h1>
            <p class="subtitle">Manage prayer requests, visits, and pastoral care</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="showTab('prayer')">Prayer Requests</button>
            <button class="tab" onclick="showTab('visits')">Hospital & Illness</button>
            <button class="tab" onclick="showTab('assignments')">Care Assignments</button>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-active-prayers">0</div>
                    <div class="stat-label">Active Prayer Requests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-scheduled-visits">0</div>
                    <div class="stat-label">Scheduled Visits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-high-severity">0</div>
                    <div class="stat-label">High Severity Cases</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-total-cases">0</div>
                    <div class="stat-label">Total Active Cases</div>
                </div>
            </div>

            <h3 style="margin-bottom: 20px; color: #2d3748;">Upcoming Follow-ups (Next 7 Days)</h3>
            <div id="upcoming-followups"></div>
        </div>

        <!-- Prayer Requests -->
        <div id="prayer" class="content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Prayer Requests</h2>
            
            <form id="prayer-form" style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <div class="form-row">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" id="prayer-name" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="prayer-category">
                            <option>Health</option>
                            <option>Family</option>
                            <option>Work</option>
                            <option>Financial</option>
                            <option>Spiritual</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Assigned To</label>
                        <select id="prayer-assigned">
                            <option>Pastor Mike</option>
                            <option>Elder Tom</option>
                            <option>Elder Sarah</option>
                            <option>Deacon James</option>
                            <option>Deacon Linda</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Request Summary *</label>
                    <textarea id="prayer-summary" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Status</label>
                        <select id="prayer-status">
                            <option>Active</option>
                            <option>Answered</option>
                            <option>Ongoing</option>
                            <option>Closed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Follow-up Date</label>
                        <input type="date" id="prayer-followup">
                    </div>
                </div>
                <button type="submit" class="btn">Add Prayer Request</button>
            </form>

            <div id="prayer-list" class="care-list"></div>
        </div>

        <!-- Hospital & Illness -->
        <div id="visits" class="content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Hospital & Illness Visits</h2>
            
            <form id="visit-form" style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <div class="form-row">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" id="visit-name" required>
                    </div>
                    <div class="form-group">
                        <label>Location/Hospital</label>
                        <input type="text" id="visit-location">
                    </div>
                    <div class="form-group">
                        <label>Severity</label>
                        <select id="visit-severity">
                            <option>Low</option>
                            <option>Moderate</option>
                            <option>High</option>
                            <option>Critical</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Situation *</label>
                    <textarea id="visit-situation" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Assigned Visitor</label>
                        <select id="visit-assigned">
                            <option>Pastor Mike</option>
                            <option>Elder Tom</option>
                            <option>Elder Sarah</option>
                            <option>Deacon James</option>
                            <option>Deacon Linda</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Visit Status</label>
                        <select id="visit-status">
                            <option>Needs Scheduling</option>
                            <option>Scheduled</option>
                            <option>Completed</option>
                            <option>Unable to Visit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Visit Date</label>
                        <input type="date" id="visit-date">
                    </div>
                </div>
                <button type="submit" class="btn">Add Visit Record</button>
            </form>

            <div id="visit-list" class="care-list"></div>
        </div>

        <!-- Care Assignments -->
        <div id="assignments" class="content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Care Assignments Overview</h2>
            <div id="assignments-list"></div>
        </div>
    </div>

    <script>
        // Data storage
        let prayerRequests = [];
        let visitRecords = [];

        // Storage functions
        async function saveData() {
            try {
                await window.storage.set('prayer-requests', JSON.stringify(prayerRequests));
                await window.storage.set('visit-records', JSON.stringify(visitRecords));
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        async function loadData() {
            try {
                const prayerData = await window.storage.get('prayer-requests');
                const visitData = await window.storage.get('visit-records');
                
                if (prayerData && prayerData.value) {
                    prayerRequests = JSON.parse(prayerData.value);
                }
                if (visitData && visitData.value) {
                    visitRecords = JSON.parse(visitData.value);
                }
            } catch (error) {
                console.log('No existing data found, starting fresh');
                prayerRequests = [];
                visitRecords = [];
            }
            
            updateAllDisplays();
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'assignments') {
                updateAssignments();
            }
        }

        // Prayer Requests
        document.getElementById('prayer-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const request = {
                id: Date.now(),
                dateAdded: new Date().toLocaleDateString(),
                name: document.getElementById('prayer-name').value,
                summary: document.getElementById('prayer-summary').value,
                category: document.getElementById('prayer-category').value,
                assigned: document.getElementById('prayer-assigned').value,
                status: document.getElementById('prayer-status').value,
                followupDate: document.getElementById('prayer-followup').value,
                lastContact: new Date().toLocaleDateString(),
                notes: ''
            };
            
            prayerRequests.push(request);
            await saveData();
            this.reset();
            updateAllDisplays();
        });

        // Visit Records
        document.getElementById('visit-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const visit = {
                id: Date.now(),
                dateReported: new Date().toLocaleDateString(),
                name: document.getElementById('visit-name').value,
                situation: document.getElementById('visit-situation').value,
                location: document.getElementById('visit-location').value,
                severity: document.getElementById('visit-severity').value,
                assigned: document.getElementById('visit-assigned').value,
                visitDate: document.getElementById('visit-date').value,
                status: document.getElementById('visit-status').value,
                notes: ''
            };
            
            visitRecords.push(visit);
            await saveData();
            this.reset();
            updateAllDisplays();
        });

        // Display functions
        function displayPrayerRequests() {
            const list = document.getElementById('prayer-list');
            
            if (prayerRequests.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üôè</div>
                        <h3>No prayer requests yet</h3>
                        <p>Add your first prayer request using the form above</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = prayerRequests.map(req => `
                <div class="care-item">
                    <div class="care-header">
                        <div>
                            <div class="care-name">${req.name}</div>
                            <div class="care-date">Added: ${req.dateAdded}</div>
                        </div>
                        <span class="badge badge-${req.status.toLowerCase()}">${req.status}</span>
                    </div>
                    <p style="margin: 10px 0; color: #4a5568;">${req.summary}</p>
                    <div class="care-details">
                        <div class="detail-item">
                            <span class="detail-label">Category</span>
                            <span class="detail-value">${req.category}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Assigned To</span>
                            <span class="detail-value">${req.assigned}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Follow-up Date</span>
                            <span class="detail-value">${req.followupDate || 'Not set'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Last Contact</span>
                            <span class="detail-value">${req.lastContact}</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="updateStatus(${req.id}, 'prayer', 'Answered')">Mark Answered</button>
                        <button class="btn btn-danger" onclick="deleteItem(${req.id}, 'prayer')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function displayVisitRecords() {
            const list = document.getElementById('visit-list');
            
            if (visitRecords.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üè•</div>
                        <h3>No visit records yet</h3>
                        <p>Add your first visit record using the form above</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = visitRecords.map(visit => `
                <div class="care-item">
                    <div class="care-header">
                        <div>
                            <div class="care-name">${visit.name}</div>
                            <div class="care-date">Reported: ${visit.dateReported}</div>
                        </div>
                        <div>
                            <span class="badge badge-${visit.severity.toLowerCase()}">${visit.severity}</span>
                            <span class="badge badge-${visit.status.toLowerCase().replace(/ /g, '-')}">${visit.status}</span>
                        </div>
                    </div>
                    <p style="margin: 10px 0; color: #4a5568;">${visit.situation}</p>
                    <div class="care-details">
                        <div class="detail-item">
                            <span class="detail-label">Location</span>
                            <span class="detail-value">${visit.location || 'Not specified'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Assigned Visitor</span>
                            <span class="detail-value">${visit.assigned}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Visit Date</span>
                            <span class="detail-value">${visit.visitDate || 'Not scheduled'}</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="updateStatus(${visit.id}, 'visit', 'Completed')">Mark Completed</button>
                        <button class="btn btn-danger" onclick="deleteItem(${visit.id}, 'visit')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function updateDashboard() {
            // Update stats
            document.getElementById('stat-active-prayers').textContent = 
                prayerRequests.filter(r => r.status === 'Active').length;
            
            document.getElementById('stat-scheduled-visits').textContent = 
                visitRecords.filter(v => v.status === 'Scheduled').length;
            
            document.getElementById('stat-high-severity').textContent = 
                visitRecords.filter(v => v.severity === 'High' || v.severity === 'Critical').length;
            
            document.getElementById('stat-total-cases').textContent = 
                prayerRequests.filter(r => r.status !== 'Closed').length + 
                visitRecords.filter(v => v.status !== 'Completed').length;

            // Upcoming follow-ups
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const upcoming = prayerRequests.filter(r => {
                if (!r.followupDate) return false;
                const followupDate = new Date(r.followupDate);
                return followupDate >= today && followupDate <= nextWeek;
            });

            const upcomingDiv = document.getElementById('upcoming-followups');
            if (upcoming.length === 0) {
                upcomingDiv.innerHTML = '<p style="color: #718096;">No follow-ups scheduled for the next 7 days</p>';
            } else {
                upcomingDiv.innerHTML = upcoming.map(r => `
                    <div class="care-item">
                        <strong>${r.name}</strong> - ${r.summary} 
                        <span style="color: #718096;">(${r.followupDate})</span>
                    </div>
                `).join('');
            }
        }

        function updateAssignments() {
            const staff = ['Pastor Mike', 'Elder Tom', 'Elder Sarah', 'Deacon James', 'Deacon Linda'];
            const assignmentsDiv = document.getElementById('assignments-list');
            
            assignmentsDiv.innerHTML = staff.map(person => {
                const prayers = prayerRequests.filter(r => r.assigned === person && r.status !== 'Closed').length;
                const visits = visitRecords.filter(v => v.assigned === person && v.status !== 'Completed').length;
                const total = prayers + visits;
                
                return `
                    <div class="care-item">
                        <div class="care-header">
                            <div class="care-name">${person}</div>
                            <div class="stat-number" style="font-size: 2em;">${total}</div>
                        </div>
                        <div class="care-details">
                            <div class="detail-item">
                                <span class="detail-label">Prayer Requests</span>
                                <span class="detail-value">${prayers}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Hospital Visits</span>
                                <span class="detail-value">${visits}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Total Active</span>
                                <span class="detail-value">${total}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function updateStatus(id, type, newStatus) {
            if (type === 'prayer') {
                const item = prayerRequests.find(r => r.id === id);
                if (item) item.status = newStatus;
            } else {
                const item = visitRecords.find(v => v.id === id);
                if (item) item.status = newStatus;
            }
            await saveData();
            updateAllDisplays();
        }

        async function deleteItem(id, type) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            if (type === 'prayer') {
                prayerRequests = prayerRequests.filter(r => r.id !== id);
            } else {
                visitRecords = visitRecords.filter(v => v.id !== id);
            }
            await saveData();
            updateAllDisplays();
        }

        function updateAllDisplays() {
            displayPrayerRequests();
            displayVisitRecords();
            updateDashboard();
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
